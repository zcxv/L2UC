diff a/l2-unity/Assets/Scripts/UI/Game/Chat/ChatWindow.cs b/l2-unity/Assets/Scripts/UI/Game/Chat/ChatWindow.cs	(rejected hunks)
@@ -4,7 +4,8 @@
 using UnityEngine;
 using UnityEngine.UIElements;
 
-public class ChatWindow : L2Window {
+public class ChatWindow : L2Window
+{
     private VisualTreeAsset _tabTemplate;
     private VisualTreeAsset _tabHeaderTemplate;
     private VisualTreeAsset _messageLabelTemplate;
@@ -21,33 +22,40 @@
     [SerializeField] private bool _chatOpened = false;
     [SerializeField] private int _chatInputCharacterLimit = 64;
 
-    
+
 
     public bool ChatOpened { get { return _chatOpened; } }
 
     private static ChatWindow _instance;
     public static ChatWindow Instance { get { return _instance; } }
 
-    private void Awake() {
-        if (_instance == null) {
+    private void Awake()
+    {
+        if (_instance == null)
+        {
             _instance = this;
-        } else {
+        }
+        else
+        {
             Destroy(this);
         }
     }
 
-    private void OnDestroy() {
+    private void OnDestroy()
+    {
         _instance = null;
     }
 
-    protected override void LoadAssets() {
+    protected override void LoadAssets()
+    {
         _windowTemplate = LoadAsset("Data/UI/_Elements/Game/Chat/ChatWindow");
         _tabTemplate = LoadAsset("Data/UI/_Elements/Game/Chat/ChatTab");
         _tabHeaderTemplate = LoadAsset("Data/UI/_Elements/Game/Chat/ChatTabHeader");
         _messageLabelTemplate = LoadAsset("Data/UI/_Elements/Game/Chat/MessageLabelTemplate");
     }
 
-    protected override IEnumerator BuildWindow(VisualElement root) {
+    protected override IEnumerator BuildWindow(VisualElement root)
+    {
         InitWindow(root);
 
         yield return new WaitForEndOfFrame();
@@ -66,12 +74,12 @@
 
         diagonalResizeHandle.AddManipulator(diagonalResizeManipulator);
 
-        _chatInput = (TextField) GetElementById("ChatInputField");
+        _chatInput = (TextField)GetElementById("ChatInputField");
         _chatInput.RegisterCallback<FocusEvent>(OnChatInputFocus);
         _chatInput.RegisterCallback<BlurEvent>(OnChatInputBlur);
         _chatInput.maxLength = _chatInputCharacterLimit;
 
-        var enlargeTextBtn = (Button) GetElementById("EnlargeTextBtn");
+        var enlargeTextBtn = (Button)GetElementById("EnlargeTextBtn");
         enlargeTextBtn.AddManipulator(new ButtonClickSoundManipulator(enlargeTextBtn));
 
         var chatOptionsBtn = (Button)GetElementById("ChatOptionsBtn");
@@ -89,20 +97,24 @@
     }
 
 
-    private void CreateTabs() {
+    private void CreateTabs()
+    {
         _chatTabView = GetElementById("ChatTabView");
 
         VisualElement tabHeaderContainer = _chatTabView.Q<VisualElement>("tab-header-container");
-        if(tabHeaderContainer == null) {
+        if (tabHeaderContainer == null)
+        {
             Debug.LogError("tab-header-container is null");
         }
         VisualElement tabContainer = _chatTabView.Q<VisualElement>("tab-content-container");
 
-        if (tabContainer == null) {
+        if (tabContainer == null)
+        {
             Debug.LogError("tab-content-container");
         }
 
-        for (int i = 0; i < _tabs.Count; i++) {
+        for (int i = 0; i < _tabs.Count; i++)
+        {
             VisualElement tabElement = _tabTemplate.CloneTree()[0];
             // tabElement.name = _tabs[i].TabName;
             tabElement.name = _tabs[i].TabName;
@@ -117,17 +129,21 @@
 
             _tabs[i].SetMessageTemplate(_messageLabelTemplate);
             _tabs[i].Initialize(_windowEle, tabElement, tabHeaderElement);
-           
+
         }
 
-        if (_tabs.Count > 0) {
+        if (_tabs.Count > 0)
+        {
             SwitchTab(_tabs[0]);
         }
     }
 
-    public bool SwitchTab(ChatTab switchTo) {
-        if (_activeTab != switchTo) {
-            if(_activeTab != null) {
+    public bool SwitchTab(ChatTab switchTo)
+    {
+        if (_activeTab != switchTo)
+        {
+            if (_activeTab != null)
+            {
                 _activeTab.TabContainer.AddToClassList("unselected-tab");
                 _activeTab.TabHeader.RemoveFromClassList("active");
             }
@@ -137,125 +153,190 @@
             ScrollDown(switchTo.Scroller);
 
             _activeTab = switchTo;
+
+            Debug.Log("switching to: " + _activeTab.TabName);
             return true;
         }
 
         return false;
     }
 
-    void Update() {
-        //if (InputManager.Instance.Validate)
-        //{
-           // if (_chatOpened)
-            //{
-            //    CloseChat(true);
-            //}
-            //else
-            //{
-             //   StartCoroutine(OpenChat());
-            //}
-        //}
+    void Update()
+    {
+        if (InputManager.Instance.Validate)
+        {
+            if (_chatOpened)
+            {
+                CloseChat(true);
+            }
+            else
+            {
+                StartCoroutine(OpenChat());
+            }
+        }
     }
 
-    IEnumerator OpenChat() {
+    IEnumerator OpenChat()
+    {
         _chatOpened = true;
         L2GameUI.Instance.BlurFocus();
         yield return new WaitForEndOfFrame();
         _chatInput.Focus();
     }
 
-    public void CloseChat(bool sendMessage) {
+    public void CloseChat(bool sendMessage)
+    {
         _chatOpened = false;
 
         L2GameUI.Instance.BlurFocus();
 
-        if(sendMessage) {
-            if(_chatInput.text.Length > 0) {
-                SendChatMessage(_chatInput.text);
-                _chatInput.value = "";
+        if (sendMessage)
+        {
+            string text = _chatInput.text;
+            if (text.Length > 0)
+            {
+                if (CanSend(1100))
+                {
+                    if (IsGmCommand(text))
+                    {
+                        String prefix = "admin_";
+                        string gmCommand = text.Substring(2);
+                        string command = prefix + gmCommand;
+                        bool enable = GameClient.Instance.IsCryptEnabled();
+                        SendGameDataQueue.Instance().AddItem(CreatorPacketsUser.CreateByPassPacket(command), enable, enable);
+                        Debug.Log("ChatWindow: requested admin command :" + command);
+                    }
+                    else
+                    {
+                        var commands = PlayerCommands.FindByText(text);
+                        if (commands != null)
+                        {
+                            bool enable = GameClient.Instance.IsCryptEnabled();
+                            SendGameDataQueue.Instance().AddItem(CreatorPacketsUser.CreateRequestUserCommand(commands.Id), enable, enable);
+                            Debug.Log("ChatWindow: requested player command :" + commands  + " id: " + commands.Id);
+                        }
+                        else
+                        {
+                            SendChatMessage(_activeTab, text);
+                        }
+                    }
+
+                    _chatInput.value = "";
+                }
+                else
+                    _activeTab.ConcatMessage("Server:Please dont spam the chat.");
             }
         }
     }
+
+    public static bool IsGmCommand(string text)
+    {
+        return text != null
+            && text.Length > 1
+            && text[0] == '/'
+            && text[1] == '/';
+    }
+
+    private long _flood = 0;
+
+    bool CanSend(long cooldownMs)
+    {
+        long now = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds();
+
+        if (now < _flood)
+            return false;
+
+        _flood = now + cooldownMs;
+        return true;
+    }
 
-    private void OnChatInputFocus(FocusEvent evt) {
-        if(!_chatInputContainer.ClassListContains("highlighted")) {
+    private void OnChatInputFocus(FocusEvent evt)
+    {
+        if (!_chatInputContainer.ClassListContains("highlighted"))
+        {
             _chatInputContainer.AddToClassList("highlighted");
         }
 
-        if(!_chatOpened) {
+        if (!_chatOpened)
+        {
             _chatOpened = true;
         }
     }
 
-    private void OnChatInputBlur(BlurEvent evt) {
-        if(_chatInputContainer.ClassListContains("highlighted")) {
+    private void OnChatInputBlur(BlurEvent evt)
+    {
+        if (_chatInputContainer.ClassListContains("highlighted"))
+        {
             _chatInputContainer.RemoveFromClassList("highlighted");
         }
 
-        if(_chatOpened) {
+        if (_chatOpened)
+        {
             _chatOpened = false;
         }
     }
 
-    public void ClearChat() {
-        for(int i = 0; i < _tabs.Count; i++) {
-            ClearTab(i);
+    public void SendChatMessage(ChatTab tab, string text)
+    {
+        ChatTypeData data = ChatTypes.GetById(tab.TabId);
+        if (data != null)
+        {
+            bool enable = GameClient.Instance.IsCryptEnabled();
+            SendGameDataQueue.Instance().AddItem(CreatorPacketsUser.CreateSendMessage(data, text), enable, enable);
+        }
+        else
+        {
+            Debug.Log("SendChatMessage : Incorrect data for tab :" + tab.TabId);
         }
     }
 
-    public void ClearTab(int tabIndex) {
-        if(tabIndex <= _tabs.Count - 1) {
-            //_tabs[tabIndex].Content.text = "";
-        }
-    }
+    public void ReceiveChatMessage(CreatureMessage data)
+    {
+        ChatType messageType = (ChatType)data._data.Type;
+
+        Debug.Log("Creature Say: Received:" + data.ToString() + " Type: " + messageType + " ChatTypeId: " + data._data.Type);
 
- 
-    public void SendChatMessage(string text) {
-        if(World.Instance.OfflineMode) {
-            ChatMessage message = new ChatMessage(PlayerEntity.Instance.IdentityInterlude.Name, text);
-            ReceiveChatMessage(message);
-        } else {
-            GameClient.Instance.ClientPacketHandler.SendMessage(text);
+        bool isAnnounce = messageType == ChatType.ANNOUNCEMENT || messageType == ChatType.CRITICAL_ANNOUNCE;
+        for (int i = 0; i < _tabs.Count; i++)
+        {
+            ChatTab tab = _tabs[i];
+
+            if (tab.ChatType == messageType || tab.ChatType == ChatType.GENERAL && isAnnounce || tab.ChatType == ChatType.GENERAL && messageType == ChatType.WHISPER)
+            {
+                tab.ConcatMessage(data.ToString());
+            }
         }
     }
 
-    public void ReceiveChatMessage(ChatMessage message) {
-        if(message == null) {
+    public void ReceiveSystemMessage(SystemMessage message)
+    {
+        if (message == null)
+        {
             return;
         }
 
-        for(int i = 0; i < _tabs.Count; i++) {
-            //if(_tabs[i].FilteredMessages.Count > 0) {
-            //    if(_tabs[i].FilteredMessages.Contains(message.MessageType)) {
-            //        ConcatMessage(_tabs[i].Content, message.ToString());
-            //    }
-            //}
-            _tabs[i].ConcatMessage( message.ToString());
+        for (int i = 0; i < _tabs.Count; i++)
+        {
+            //if(_tabs[i].FilteredMessages.Count > 0)
+            // {
+            // if (_tabs[i].FilteredMessages.Contains(message.MessageType))
+            // {
+            // ConcatMessage(_tabs[i].Content, message.ToString());
+            // }
+            // }
+            _tabs[i].ConcatMessage(message.ToString());
         }
     }
 
-    public void ReceiveSystemMessage(SystemMessage message) {
-        if (message == null) {
-            return;
-        }
-
-        for (int i = 0; i < _tabs.Count; i++) {
-            //if(_tabs[i].FilteredMessages.Count > 0) {
-            //    if(_tabs[i].FilteredMessages.Contains(message.MessageType)) {
-            //        ConcatMessage(_tabs[i].Content, message.ToString());
-            //    }
-            //}
-            _tabs[i].ConcatMessage( message.ToString());
-        }
-    }
 
- 
 
-    internal void ScrollDown(Scroller scroller) {
+    internal void ScrollDown(Scroller scroller)
+    {
         StartCoroutine(ScrollDownWithDelay(scroller));
     }
 
-    IEnumerator ScrollDownWithDelay(Scroller scroller) {
+    IEnumerator ScrollDownWithDelay(Scroller scroller)
+    {
         yield return new WaitForEndOfFrame();
         scroller.value = scroller.highValue > 0 ? scroller.highValue : 0;
     }
